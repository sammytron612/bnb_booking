(function(){if(window.bookingCalendarInitialized)return;window.bookingCalendarInitialized=!0;const S=2;let I=new Date,M=I.getFullYear(),m=I.getMonth(),v=new Set,x=new Set,F=new Set,r=new Set,t=null,n=null;function G(){const i=window.location.pathname;return i.includes("light-house")?1:i.includes("saras")?2:1}const O=G(),s=i=>{if(!i)return"";const d=i.getFullYear(),c=String(i.getMonth()+1).padStart(2,"0"),w=String(i.getDate()).padStart(2,"0");return`${d}-${c}-${w}`},f=(i,d)=>new Date(i.getFullYear(),i.getMonth(),i.getDate()+d),U=(i,d)=>Math.round((d-i)/(1e3*60*60*24));function R(i){const d=s(i);if(r.has(d))return!1;let c=!0;for(let g=0;g<S;g++){const D=f(i,g),E=s(D);if(r.has(E)){c=!1;break}}let w=!0;for(let g=1;g<=S;g++){const D=f(i,-g),E=s(D);if(r.has(E)){w=!1;break}}return!c&&!w}function j(){const i=document.getElementById("calendarTitle"),d=document.getElementById("daysGrid"),c=document.getElementById("bookingModal"),w=document.getElementById("openBookingModal"),g=document.getElementById("closeBookingModal"),D=document.getElementById("clearSelectionBtn"),E=document.getElementById("prevMonth"),q=document.getElementById("nextMonth");if(console.log("Booking modal elements:",{titleEl:!!i,gridEl:!!d,bookingModal:!!c,openBookingBtn:!!w,closeBookingBtn:!!g,clearSelectionBtn:!!D}),i&&d&&c){let B=function(){const e=new Date(M,m,1),l=e.getDay(),o=new Date(M,m+1,0).getDate();i.textContent=e.toLocaleString(void 0,{month:"long",year:"numeric"}),d.innerHTML="";for(let a=0;a<l;a++)d.appendChild(document.createElement("div"));for(let a=1;a<=o;a++){const h=new Date(M,m,a),y=s(h),A=new Date(I.getFullYear(),I.getMonth(),I.getDate()),k=h<A,C=x.has(y),L=F.has(y),T=r.has(y);v.has(y);const Y=R(h),_=t&&n&&h>=t&&h<n,J=t&&s(h)===s(t),Q=n&&s(h)===s(f(n,-1)),b=document.createElement("button");b.setAttribute("type","button");let p=["bg-white h-14 w-full text-sm flex items-center justify-center","focus:outline-none","hover:bg-gray-50"];const V=!k&&!Y&&!T;Y?p.push("line-through text-gray-400 bg-red-50 cursor-not-allowed border border-red-200"):T?p.push("line-through text-gray-400 bg-gray-100 cursor-not-allowed"):C?p.push("bg-orange-50 text-orange-700 border border-orange-200"):L&&p.push("bg-green-50 text-green-700 border border-green-200"),k&&p.push("opacity-40 cursor-not-allowed"),V&&p.push("cursor-pointer"),_&&p.push("bg-pink-50 text-pink-700 font-semibold"),(J||Q)&&p.push("ring-2 ring-pink-500 font-bold"),b.className=p.join(" "),b.textContent=a,Y?b.title="Unavailable - Cannot accommodate minimum 2-night stay":C?b.title="Check-in day - Available for checkout (11am departure, 3pm arrival)":L?b.title="Check-out day - Available for check-in (11am departure, 3pm arrival)":T&&!C&&!L&&(b.title="Fully booked"),V&&b.addEventListener("click",()=>H(h));const N=document.createElement("div");N.className="bg-white",N.appendChild(b),d.appendChild(N)}K()},z=function(){t=null,n=null;const e=document.getElementById("guestDetailsForm");e&&e.reset(),B()},H=function(e){const l=s(e),u=R(e),o=x.has(l);console.log("Clicked date:",l,{isOrphaned:u,isCheckInDay:o,fullyBookedDates:r.has(l),currentCheckIn:t?s(t):null,currentCheckOut:n?s(n):null,fullyBookedSet:Array.from(r),dateKeyType:typeof l});const a=t&&s(e)===s(t),h=n&&s(e)===s(f(n,-1));if(u&&(a||h)){z();return}if(r.has(l)||u){console.log("Blocked selection:",l,"fullyBooked:",r.has(l),"isOrphaned:",u);return}if(!t){console.log("Starting new selection from:",l),t=e,n=f(e,1),B();return}console.log("Extending selection to:",l),e<t?t=e:(e>=n||(t=e),n=f(e,1));let y=new Date(t),A=!1;for(;y<n;){const k=s(y);if(r.has(k)){console.log("Selection blocked by fully booked night:",k),A=!0;break}y=f(y,1)}if(A&&(console.log("Resetting to single night due to conflict"),t=e,n=f(e,1)),U(t,n)<S){console.log("Enforcing minimum nights:",S),n=f(t,S);let k=new Date(t),C=!1;for(;k<n;){const L=s(k);if(r.has(L)){console.log("Cannot meet minimum nights requirement due to fully booked night:",L),C=!0;break}k=f(k,1)}if(C){console.log("Cannot meet minimum nights requirement, clearing selection"),t=null,n=null,B();return}}console.log("Final selection:",s(t),"to",s(n)),B()},K=function(){if(typeof Livewire<"u")if(t&&n){const e=P(t),l=P(n);Livewire.dispatch("datesSelected",{checkIn:e,checkOut:l})}else Livewire.dispatch("datesCleared")},P=function(e){if(!e)return null;const l=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${l}-${u}-${o}`};var X=B,Z=z,ee=H,te=K,ne=P;E&&E.addEventListener("click",async()=>{m--,m<0&&(m=11,M--),await $(O)}),q&&q.addEventListener("click",async()=>{m++,m>11&&(m=0,M++),await $(O)}),D&&D.addEventListener("click",()=>{z()}),typeof Livewire<"u"&&document.addEventListener("livewire:init",()=>{Livewire.on("clearCalendarSelection",()=>{t=null,n=null,B(),K()}),Livewire.on("bookingSubmitted",e=>{c&&(c.classList.add("hidden"),c.classList.remove("flex"),document.body.classList.remove("overflow-hidden")),alert("Booking submitted successfully! We will contact you shortly.")})});async function W(e=null){try{const l=e?`/api/booked-dates?venue_id=${e}`:"/api/booked-dates";console.log("Fetching booked dates from:",l);const u=await fetch(l);if(console.log("Response status:",u.status),!u.ok)throw new Error(`HTTP ${u.status}: ${u.statusText}`);const o=await u.json();return console.log("API Response:",o),o.success?(x.clear(),F.clear(),r.clear(),v.clear(),o.checkInDates&&(console.log("Check-in dates from API:",o.checkInDates),o.checkInDates.forEach(a=>{x.add(a),v.add(a)})),o.checkOutDates&&(console.log("Check-out dates from API:",o.checkOutDates),o.checkOutDates.forEach(a=>{F.add(a)})),o.fullyBookedDates&&(console.log("Fully booked dates from API:",o.fullyBookedDates),o.fullyBookedDates.forEach(a=>{r.add(a),v.add(a)})),o.bookedDates&&!o.checkInDates&&o.bookedDates.forEach(a=>{v.add(a)}),console.log(`Loaded booking data - Check-ins: ${x.size}, Check-outs: ${F.size}, Fully booked: ${r.size}`),o.count||o.bookedDates?.length||0):(console.error("Failed to load booked dates:",o),0)}catch(l){return console.error("Error loading booked dates from database:",l),0}}async function $(e=null){v.clear(),await W(e),B()}if($(O),c&&w){let e=function(){c.classList.add("hidden"),c.classList.remove("flex"),document.body.style.overflow=""};var oe=e;w.addEventListener("click",async()=>{c.classList.remove("hidden"),c.classList.add("flex"),document.body.style.overflow="hidden",await $(O)}),g&&g.addEventListener("click",e),c.addEventListener("click",l=>{l.target===c&&e()}),console.log("Booking functionality is handled through Livewire component")}}else console.log("Booking calendar elements not found - skipping initialization")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j()})();
